// App.js
import React, { useState } from 'react';
import FileInput from './components/FileInput';
import PdfDisplay from './components/PdfDisplay';
import { uploadFile, addRecord } from './service';

function App() {
  const [selectedFile, setSelectedFile] = useState(null);
  const [pdfData, setPdfData] = useState(null);
  const [approval, setApproval] = useState(null);

  const handleFileChange = (file) => {
    setSelectedFile(file);
    // setPdfData(data);
    setApproval(null);
  };

  const handleFileUpload = async () => {
    try {
      if (selectedFile) {
        const response = await uploadFile(selectedFile);
        setPdfData(response);
        setApproval(null);
      }
    } catch (error) {
      console.error('Error uploading file:', error);
    }
  };

  const handleApprovalChange = (event) => {
    setApproval(event.target.value);
  };

  const handleSubmit = async () => {
    try {
      if (approval && selectedFile) {
        // Add the record to the database
        await addRecord(selectedFile, approval, pdfData);
        // Log the approval status to the console
        console.log(`File approval status: ${approval}`);
      }
    } catch (error) {
      console.error('Error submitting:', error);
    }
  };

  return (
    <div>
      <h1>PDF Reader App</h1>
      <FileInput onFileChange={handleFileChange} onFileUpload={handleFileUpload} />
      {pdfData && <PdfDisplay pdfData={pdfData} setPdfData={setPdfData}/>}
      {pdfData && (
        <div>
          <h2>Approve:</h2>
          <label>
            <input
              type="radio"
              value="GE"
              checked={approval === 'GE'}
              onChange={handleApprovalChange}
            />
            GE
          </label>
          <label>
            <input
              type="radio"
              value="NGE"
              checked={approval === 'NGE'}
              onChange={handleApprovalChange}
            />
            NGE
          </label>
          <br />
          <button onClick={handleSubmit}>Submit</button>
        </div>
      )}
    </div>
  );
}

export default App;





// PdfDisplay.js
import React, { useState } from 'react';
import '../style.css';

const PdfDisplay = ({ pdfData, setPdfData }) => {
  const [editablePdfData, setEditablePdfData] = useState(pdfData);

  const handleValueChange = (key, newValue) => {
    setEditablePdfData(prevData => ({
      ...prevData,
      [key]: newValue
    }));
  };

  const handleSaveChanges = () => {
    // Create a new object with updated values
    const updatedPdfData = { ...pdfData, ...editablePdfData };
    // Update the pdfData state in App.js
    setPdfData(updatedPdfData);
  };

  const renderTable = () => {
    return (
      <table className="pdf-table">
        <thead>
          <tr>
            <th>Key</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody>
          {Object.entries(editablePdfData).map(([key, value]) => (
            <tr key={key}>
              <td className="pdf-key">{key}</td>
              <td>
                <input
                  type="text"
                  value={value}
                  onChange={(e) => handleValueChange(key, e.target.value)}
                />
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    );
  };

  return (
    <div>
      <h2>PDF Data:</h2>
      {renderTable()}
      <button onClick={handleSaveChanges}>Save Changes</button>
    </div>
  );
};

export default PdfDisplay;
